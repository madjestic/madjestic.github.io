<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content>
	<meta name="author" content>
	<link rel="shortcut icon" href="../../docs-assets/ico/favicon.ico">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>My Hakyll Blog - fmap versus recursion</title>

        <link href="../css/default.css" rel="stylesheet" type="text/css">

	<!-- Bootstrap core CSS -->
	<link href="../css/bootstrap.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="../css/starter-template.css" rel="stylesheet">

	<!-- Code syntax highlighting CSS -->
	<link href="../css/syntax.css" rel="stylesheet">

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-52989677-1', 'auto');
    ga('send', 'pageview');

  </script>

    </head>

    <body>
	
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	    <div class="container">
		<div class="navbar-header">
		    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="https://github.com/madjestic/madjestic.github.io">GitHub</a>
		</div>
		<div class="collapse navbar-collapse">
		    <ul class="nav navbar-nav">
			<li class="active"><a href="../">Home</a></li>
			<li><a href="#about">About</a></li>
			<li><a href="#contact">Contact</a></li>
		    </ul>
		</div><!--/.nav-collapse -->
	    </div>
	</div>

	<div class="container">

	    <div class="row row-offcanvas row-offcanvas-right">

		<div class="col-xs-12 col-sm-10">
		    <head>
  			<a href="../"><img width="100%" src="../images/turtles_sponge_header.jpg" /></a>
		    </head>

		    <!-- content -->
		    <div class="starter-template">
			<!-- <h1>fmap versus recursion</h1> -->
		    </div>
		    <div>
			<p class="small"><div class="info">
    Posted on December 30, 2013
    
</div>

<h2 id="fmap-vs.recursion">fmap vs. recursion</h2>
<p><br /><br />A):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">mapLabel ::</span>  <span class="dt">Eq</span> a <span class="ot">=></span> (a <span class="ot">-></span> b) <span class="ot">-></span> <span class="dt">Tree</span> a <span class="ot">-></span> <span class="dt">Tree</span> b
mapLabel f (<span class="dt">Node</span> label []) <span class="fu">=</span> <span class="dt">Node</span> (f label) []
mapLabel f (<span class="dt">Node</span> label subTrees) <span class="fu">=</span> (<span class="dt">Node</span> (f label) (subLeaves subTrees))
	<span class="kw">where</span> subLeaves [] <span class="fu">=</span> []
        subLeaves (t<span class="fu">:</span>ts)
            <span class="fu">|</span> leaf t    <span class="fu">=</span>  <span class="dt">Node</span> (f label) [] <span class="fu">:</span> subLeaves ts
			<span class="fu">|</span> otherwise <span class="fu">=</span>  <span class="dt">Node</span> (f label) (subLeaves subTrees) <span class="fu">:</span> subLeaves ts
                                      </code></pre>
<p>B):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">fmap f (<span class="dt">Node</span> x ts) <span class="fu">=</span> <span class="dt">Node</span> (f x) (map (fmap f) ts)</code></pre>
<p><br /> The idea was to create a function that would walk through a tree-like data structure and do some stuff to it. First I spent 2 evenings designing (or understanding rather) a recursive patter-matching function. The evening I was able to compile it <em>and</em> produce the expected result – I felt quite content with myself…</p>
<p>C):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">mapLabel ::</span>  <span class="dt">Eq</span> a <span class="ot">=></span> (a <span class="ot">-></span> b) <span class="ot">-></span> <span class="dt">Tree</span> a <span class="ot">-></span> <span class="dt">Tree</span> b
mapLabel f (<span class="dt">Node</span> label []) <span class="fu">=</span> <span class="dt">Node</span> (f label) []
mapLabel f (<span class="dt">Node</span> label subTrees) <span class="fu">=</span> (<span class="dt">Node</span> (f label) (subLeaves subTrees))
    <span class="kw">where</span> subLeaves [] <span class="fu">=</span> []
        subLeaves (t<span class="fu">:</span>ts)
            <span class="fu">|</span> leaf t    <span class="fu">=</span>  <span class="dt">Node</span> (f label) [] <span class="fu">:</span> subLeaves ts
			<span class="fu">|</span> otherwise <span class="fu">=</span>  <span class="dt">Node</span> (f label) (subLeaves subTrees) <span class="fu">:</span> subLeaves ts
                <span class="kw">where</span> label    <span class="fu">=</span> rootLabel t</code></pre>
<p>Just look at the awe-inspiring complexity of it!.. How is it even possible that my humble mind was able to grasp that? Then I revisited some of the related source-code inside Data.Tree module:</p>
<p>D):</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Functor</span> <span class="dt">Tree</span> <span class="kw">where</span>
    fmap f (<span class="dt">Node</span> x ts) <span class="fu">=</span> <span class="dt">Node</span> (f x) (map (fmap f) ts)</code></pre>
<p>… So much for the awesome complexity. It turned out the the solution B) is functionally equivalent to A) and has additional benefit of being so much more concise and easy to re-factor into, say, this:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell">fmap f (<span class="dt">Node</span> x ts) <span class="fu">=</span> <span class="dt">Node</span> (f ts) (map (fmap f) ts)</code></pre>
<p>(This function will recursively operate on ts (pattern-matched to subForest members), rather than on the x (rootLabel), as in the function above, without loosing readability – ain’t that just peachy?):</p>
<p>Further example of the same principle:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- A and B are roughly equivalent:</span>
<span class="co">-- A:</span>
<span class="ot">gamma ::</span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">Int</span>
gamma t k <span class="fu">=</span> <span class="dt">Node</span> a forest 
           <span class="kw">where</span> a      <span class="fu">=</span> (\[x, y] <span class="ot">-></span> x<span class="fu">*</span>y) <span class="fu">$</span> map read <span class="fu">$</span> map rootLabel [t,k]
                 forest <span class="fu">=</span> (multIntForests (subForest t) (subForest k)) 

<span class="ot">multIntTrees ::</span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">Int</span>
multIntTrees <span class="fu">=</span> gamma
 

<span class="ot">multIntForests ::</span> [<span class="dt">Tree</span> <span class="dt">String</span>] <span class="ot">-></span> [<span class="dt">Tree</span> <span class="dt">String</span>]<span class="ot">-></span> [<span class="dt">Tree</span> <span class="dt">Int</span>]
multIntForests [] _ <span class="fu">=</span> []
multIntForests _ [] <span class="fu">=</span> []
multIntForests (t<span class="fu">:</span>ts) (k<span class="fu">:</span>ks) <span class="fu">=</span> gamma t k <span class="fu">:</span> multIntForests ts ks 


<span class="co">-- B:</span>
delta f (<span class="dt">Node</span> a ts) (<span class="dt">Node</span> b ks) <span class="fu">=</span> (<span class="dt">Node</span> (f a b) (zipWith (delta f) ts ks))</code></pre>
<p>… And more examples:</p>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- A and B are equivalent:</span>
<span class="co">-- A:</span>
<span class="co">-- Aquire a tree with the number of sub-nodes as a value of the rootLabel:</span>
<span class="ot">members ::</span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">String</span>
members (<span class="dt">Node</span> x [])  <span class="fu">=</span> <span class="dt">Node</span> {rootLabel <span class="fu">=</span> <span class="st">"0"</span>, subForest <span class="fu">=</span> []}
members (<span class="dt">Node</span> x ts0) <span class="fu">=</span> <span class="dt">Node</span> {rootLabel <span class="fu">=</span> (show <span class="fu">$</span> length ts0), subForest <span class="fu">=</span> subNodes ts0}
     <span class="kw">where</span> subNodes []     <span class="fu">=</span> []
           subNodes [t]    <span class="fu">=</span> members t <span class="fu">:</span> []
           subNodes (t<span class="fu">:</span>ts) <span class="fu">=</span> (members t)<span class="fu">:</span> subNodes ts

<span class="co">-- B:</span>
<span class="ot">members ::</span> <span class="dt">Tree</span> <span class="dt">String</span> <span class="ot">-></span> <span class="dt">Tree</span> <span class="dt">String</span>
members <span class="fu">=</span> fmap length</code></pre>
</p>
		    </div>
		    <!-- /content -->
		    
		    <div class="row">
			<div id="footer">
		            Site proudly generated by
			    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
			</div>
		    </div>
		    <!-- /.container -->

		</div>
		
		<div class="col-xs-12 col-sm-2 sidebar-offcanvas" id="sidebar" role="navigation">
		    <div class="list-group">
			<a href="http://www.apileofgrains.nl/" class="list-group-item">A Pile of Grains</a>
			<a href="https://sites.google.com/site/77neuronsprojectperelman/" class="list-group-item">Project Perelman</a>
		    </div>
		</div>
	    </div>

	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'turtlesturtlesturtles'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	    </script>
	    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	    

	</div><!-- /.container -->

	<!-- Bootstrap core JavaScript
        ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>

    </body>
</html>
