<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content>
	<meta name="author" content>
	<link rel="shortcut icon" href="../../docs-assets/ico/favicon.ico">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>TurtlesTurtlesTurtles - e1337</title>

        <link href="../css/default.css" rel="stylesheet" type="text/css">

	<!-- Bootstrap core CSS -->
	<link href="../css/bootstrap.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="../css/starter-template.css" rel="stylesheet">

	<!-- Code syntax highlighting CSS -->
	<link href="../css/syntax.css" rel="stylesheet">

      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
        ga('create', 'UA-52989677-1', 'auto');
        ga('send', 'pageview');
      
      </script>
    </head>

    <body>
	
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	    <div class="container">
		<div class="navbar-header">
		    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="https://github.com/madjestic/madjestic.github.io">GitHub</a>
		</div>
		<div class="collapse navbar-collapse">
		    <ul class="nav navbar-nav">
			<li class="active"><a href="../">Home</a></li>
			<li><a href="about.html">About</a></li>
			<li><a href="contact.html">Contact</a></li>
		    </ul>
		</div><!--/.nav-collapse -->
	    </div>
	</div>

	<div class="container">

	    <div class="row row-offcanvas row-offcanvas-right">

		<div class="col-xs-12 col-sm-10">
		    <head>
  			<a href="../"><img width="100%" src="../images/turtles_header_gosper.png" /></a>
		    </head>

		    <!-- content -->
		    <div class="starter-template">
			<!-- <h1>e1337</h1> -->
		    </div>
		    <div>
			<p class="small"><!-- STYLESHEETS -->

<style>
img { 
    width: 100%; 
}
</style>

<!-- HEADER -->
<div class="info">
    Posted on May 17, 2020
    
</div>

<!-- BODY -->
<h3 id="making-a-space-sim-game-in-haskell.">Making a space-sim game in Haskell.</h3>
<h4 id="tags-haskell-opengl-frp-yampa-game.">#tags: haskell, opengl, frp, yampa, game.</h4>
<p><br />
</p>
<h4 id="heres-a-journal-of-a-space-game-ive-been-working-on.-it-is-written-in-haskell-uses-python-for-the-pipeline-opengl-4.5-yampa-sdl2.">Here’s a journal of a space game I’ve been working on. It is written in haskell, uses python for the pipeline, OpenGL 4.5+, Yampa, SDL2.</h4>
<p><br />
<img src="../images/output.png" /></p>
<p><a href="https://youtu.be/A5U13pmyawI">video</a></p>
<p><a href="https://github.com/madjestic/e1337">github</a></p>
<p><br />
</p>
<h3 id="the-beginning-a-mandelbrot-set.">00: The beginning: a mandelbrot set.</h3>
<h4 id="circa-2013-when-project-started-it-looked-like-there-was-nothing-suitable-for-using-as-a-basis-for-a-game.">Circa 2013, when project started, it looked like there was nothing suitable for using as a basis for a game.</h4>
<p>There was Gloss which seemed too high level, compared to OpenGL; there was lambdacube, which was a thing on it’s own (but that replaces mastering Haskell and OpenGL with mastering somebodys interpretation); there was gl-piles, which looked interesting, but was suffering from the same problem as lambdacube - basically being wrappers. I don’t like wrappers. Wrappers do little good, aside from looking like they solve a (complex) problem, hiding (unnecessary?) complexity away, while creating more confusion, because the underlying reasoning is hiddent away, replaced with another, arguably more accessible reasoning.</p>
<p>But we digress.</p>
<h4 id="i-started-of-where-i-left-off-the-haskell-opengl-tutorial">I started of where I left off the <a href="https://github.com/madjestic/Haskell-OpenGL-Tutorial">Haskell-OpenGL-Tutorial</a>:</h4>
<p><img src="../images/output_01.png" /></p>
<h5 id="its-a-simple-hard-coded-scene-with-a-fixed-camera-2-triangles-with-a-material-consisting-from-a-vertex-and-a-fragmen-shader-with-animated-time-variable-fed-to-the-shader.">It’s a simple, hard-coded scene with a fixed camera, 2 triangles with a material consisting from a vertex and a fragmen shader, with animated time variable fed to the shader.</h5>
<p>At this point it was a like a desktop version of <a href="https://www.shadertoy.com/">shader-toy</a>. But why stopping there? There are cameras, animations and user-events, so let’s add these features:</p>
<p><br />
</p>
<h3 id="adding-basic-camera-controls.">01: Adding basic camera controls.</h3>
<p>GitHub is a great source of code examples. Though there seemed to be no suitabke stackoverflow questions and answers, or tutorials, despite hours of searching that gave little to no useful results, after mosh-pitting together a number of code samples from awesome folks from GitHub, basic camera controlls were added.<br />
No mouse input support yet. It feels like playing Doom with keyboard alone.</p>
<p><img src="../images/output_02.png" /> <a href="https://www.youtube.com/watch?v=JqIMZHPDk5o">video</a></p>
<p><img src="../images/output_03.png" /> <a href="https://www.youtube.com/watch?v=h6v8J7UkGFk">video</a></p>
<p><img src="../images/output_04.png" /> <a href="https://www.youtube.com/watch?v=qNefvisENXI">video</a></p>
<p><img src="../images/output_05.png" /> <a href="https://www.youtube.com/watch?v=jpZ_gdws-Nk">video</a></p>
<p>Loading anything more complex than a few triangles is begging for a model description and supporting authoring tools. There are many 3d modelling tools out there, I am most familiar with <a href="http://sidefx.com/">SideFX Houdini</a>, so let’s try to use the <a href="https://www.sidefx.com/products/houdini-apprentice/">free non-commercial version</a> and Houdini’s native <a href="https://www.sidefx.com/docs/houdini/io/formats/geo.html"><code>geo</code></a> format as a model description that our application can read and fix the gaps in-between with python plumbing.</p>
<p>Let’s start with ~40K triangles:</p>
<p><img src="../images/output_06.png" /> <a href="https://www.youtube.com/watch?v=lJfOzcvqTJ0">video</a></p>
<p>Increase to ~50K tris:</p>
<p><img src="../images/output_07.png" /> <a href="https://www.youtube.com/watch?v=7QpUubK6ADc">video</a></p>
<p>loading ~250K took a few hours.</p>
<p><img src="../images/output_08.png" /> <a href="https://www.youtube.com/watch?v=oiajlYck-50">video</a></p>
<p>At this point it became clear that:</p>
<ul>
<li>ascii json file format is impractical for reading models of more than 100K tris. We need a quick binary serialization.<br />
</li>
<li>It may be beneficial to use indexed geometry attributes.</li>
<li>Project format description is highly desirable, as it gets tedious changing hard-coded scenes every time the project needs to change.</li>
</ul>
<p>Let’s throw them in:</p>
<ul>
<li><a href="http://hackage.haskell.org/package/store-0.7.4/docs/Data-Store.html">Data.Store</a> for binary serialization.</li>
<li>Add attribute indexing.</li>
<li>Use json for describing project files like so:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1"></a>  <span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>    <span class="dt">&quot;project&quot;</span><span class="fu">:</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="fu">{</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>	<span class="dt">&quot;name&quot;</span>  <span class="fu">:</span> <span class="st">&quot;Mandelbrot&quot;</span><span class="fu">,</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>	<span class="dt">&quot;resx&quot;</span>  <span class="fu">:</span> <span class="dv">800</span><span class="fu">,</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>	<span class="dt">&quot;resy&quot;</span>  <span class="fu">:</span> <span class="dv">600</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>	<span class="dt">&quot;models&quot;</span><span class="fu">:</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>	<span class="ot">[</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/test.bgeo&quot;</span> <span class="fu">}</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>	<span class="ot">]</span></span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="fu">}</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">}</span></span></code></pre></div>
<p><img src="../images/output_09.png" /> <a href="https://www.youtube.com/watch?v=DApECcZsKfc">video</a></p>
<p>Basic model loading is working, let’s expand supported attributes: Color, Alpha, Normal, UVW: <img src="../images/output_10.png" /> <a href="https://www.youtube.com/watch?v=KVFu1DjKTCE">video</a></p>
<p>Add more test materials: <img src="../images/output_11.png" /> <a href="https://www.youtube.com/watch?v=IrTWsGjq6hc">video</a></p>
<p>It is obvious that a single object may need more than one material: <img src="../images/output_12.png" /> <a href="https://www.youtube.com/watch?v=EYwBZOm5GNE">video</a></p>
<p>Where’s many materials - there’s many objects. Expand the project description to support multiple objects:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1"></a>  <span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="dt">&quot;project&quot;</span><span class="fu">:</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="fu">{</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>	<span class="dt">&quot;name&quot;</span>  <span class="fu">:</span> <span class="st">&quot;Eath, ISS&quot;</span><span class="fu">,</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>	<span class="dt">&quot;resx&quot;</span>  <span class="fu">:</span> <span class="dv">800</span><span class="fu">,</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>	<span class="dt">&quot;resy&quot;</span>  <span class="fu">:</span> <span class="dv">600</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>	<span class="dt">&quot;models&quot;</span><span class="fu">:</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>	<span class="ot">[</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/earth.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/moon.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/iss_L1.bgeo&quot;</span> <span class="fu">}</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>	<span class="ot">]</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="fu">}</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="fu">}</span></span></code></pre></div>
<p><img src="../images/output_13.png" /> <a href="https://www.youtube.com/watch?v=CSedgiMpKzg">video</a></p>
<p>Many objects with individual update loops, expand project description:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb3-1"><a href="#cb3-1"></a>  <span class="fu">{</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="dt">&quot;project&quot;</span><span class="fu">:</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="fu">{</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>	<span class="dt">&quot;name&quot;</span>  <span class="fu">:</span> <span class="st">&quot;Eath, ISS&quot;</span><span class="fu">,</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>	<span class="dt">&quot;resx&quot;</span>  <span class="fu">:</span> <span class="dv">800</span><span class="fu">,</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>	<span class="dt">&quot;resy&quot;</span>  <span class="fu">:</span> <span class="dv">600</span><span class="fu">,</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>	<span class="dt">&quot;models&quot;</span><span class="fu">:</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>	<span class="ot">[</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/earth.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/moon.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/iss_L1.bgeo&quot;</span> <span class="fu">}</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>	<span class="ot">]</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="fu">}</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="fu">}</span></span></code></pre></div>
<p><img src="../images/output_14.png" /> <a href="https://www.youtube.com/watch?v=S2WPuo63r5g">video</a></p>
<p>More testing: <img src="../images/output_15.png" /> <a href="https://www.youtube.com/watch?v=rnkZqXXqWYA">video</a></p>
<p>And more: <img src="../images/output_16.png" /> <a href="https://www.youtube.com/watch?v=Oqiyv4zhxWE">video</a></p>
<p>Time to move beyond simple test scenes: <img src="../images/output_17.png" /> <a href="https://www.youtube.com/watch?v=oE2jpa8ojOk">video</a></p>
<p>After initial composition is done, set the scene to realistic proportions and distances:</p>
<p><img src="../images/output_18.png" /> <a href="https://www.youtube.com/watch?v=W4Ry082HYCA">video</a></p>
<p>Realistic proportions reveal floating point precision issues, as seen in the video. Logarithmic scales seem to fix it:</p>
<p><img src="../images/output_19.png" /> <a href="https://www.youtube.com/watch?v=pHV2LUEQ-Dw">video</a></p>
<p>Rainbow colors of the vertices reveal errors in attribute values. Let’s fix that. Logarithmic scales cause clipping artifacts. Also let’s further expand project format to support initial camera position:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1"></a>  <span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="dt">&quot;project&quot;</span><span class="fu">:</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="fu">{</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>	<span class="dt">&quot;name&quot;</span>  <span class="fu">:</span> <span class="st">&quot;Eath, ISS&quot;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>	<span class="dt">&quot;resx&quot;</span>  <span class="fu">:</span> <span class="dv">800</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>	<span class="dt">&quot;resy&quot;</span>  <span class="fu">:</span> <span class="dv">600</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>	<span class="dt">&quot;models&quot;</span><span class="fu">:</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>	<span class="ot">[</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/earth.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/moon.bgeo&quot;</span> <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>	    <span class="fu">{</span> <span class="dt">&quot;path&quot;</span><span class="fu">:</span> <span class="st">&quot;models/iss_L1.bgeo&quot;</span> <span class="fu">}</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>	<span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>	<span class="dt">&quot;camera&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>		   <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>		   <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">,</span><span class="dv">-60</span><span class="ot">,</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>		   <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">0</span><span class="ot">,</span> <span class="dv">1</span><span class="ot">]</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>    <span class="fu">}</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="fu">}</span></span></code></pre></div>
<p><img src="../images/output.png" /> <a href="https://www.youtube.com/watch?v=A5U13pmyawI">video</a></p>
<h4 id="references">References:</h4>
<p>https://learnopengl.com/ http://learnyouahaskell.com/</p>

<img src="../images/null.png" style="width:10px;height:10px;">
</p>
		    </div>
		    <!-- /content -->
		    
		    <div class="row">
			<div id="footer">
		            Site proudly generated by
			    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
			</div>
		    </div>
		    <!-- /.container -->

		</div>
		
		<div class="col-xs-12 col-sm-2 sidebar-offcanvas" id="sidebar" role="navigation">
		    <div class="list-group">
			<a href="http://www.apileofgrains.nl/" class="list-group-item">A Pile of Grains</a>
			<a href="https://sites.google.com/site/77neuronsprojectperelman/" class="list-group-item">Project Perelman</a>
		    </div>
		</div>
	    </div>

	    <div id="disqus_thread"></div>
	    <script type="text/javascript">
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		var disqus_shortname = 'turtlesturtlesturtles'; // required: replace example with your forum shortname

		/* * * DON'T EDIT BELOW THIS LINE * * */
		(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	    </script>
	    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	    

	</div><!-- /.container -->

	<!-- Bootstrap core JavaScript
        ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>

    </body>
</html>
